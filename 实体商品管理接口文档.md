# 实体商品管理接口文档

## 概述
本模块实现了实体商品（productType=1）的完整管理功能，与课程管理（productType=0）并存，共享 `eb_product` 表。

## 核心特性
- **商品与课程并存**：通过 `product_type` 字段区分实体商品和课程
- **完整的CRUD功能**：列表查询、详情、创建、更新、删除
- **SKU/规格管理**：支持多规格商品管理
- **上下架管理**：独立的上架/下架功能
- **统计功能**：商品数据统计

## 数据库字段说明

### Product表关键字段
- `product_type`: 产品类型（**0-课程，1-实体商品**）
- `type`: 基础类型（0=普通商品,1-积分商品,2-虚拟商品,4=视频号,5-云盘商品,6-卡密商品）
- `is_del`: 是否删除（软删除）
- `is_show`: 是否上架（0-未上架，1-上架）
- `audit_status`: 审核状态（0-无需审核，1-待审核，2-审核成功，3-审核拒绝）

## API接口列表

### 基础路径
```
/api/admin/platform/physical-product
```

---

## 1. 商品列表查询

### 接口地址
```
GET /api/admin/platform/physical-product/list
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| page | Integer | 否 | 页码 | 1 |
| limit | Integer | 否 | 每页数量 | 20 |
| name | String | 否 | 商品名称（模糊查询） | "迪士尼T恤" |
| categoryId | Integer | 否 | 平台分类ID | 7 |
| brandId | Integer | 否 | 品牌ID | 32 |
| isShow | Boolean | 否 | 是否上架 | true |
| auditStatus | Integer | 否 | 审核状态 | 2 |
| type | Integer | 否 | 商品类型 | 0 |
| priceMin | String | 否 | 最低价格 | "10.00" |
| priceMax | String | 否 | 最高价格 | "500.00" |
| sortField | String | 否 | 排序字段（sales/price/create_time） | "create_time" |
| sortOrder | String | 否 | 排序方式（asc/desc） | "desc" |

### 响应示例
```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "list": [
      {
        "id": 94,
        "name": "迪士尼联名T恤",
        "image": "https://...",
        "price": 109.00,
        "stock": 180,
        "sales": 0,
        "isShow": true,
        "auditStatus": 2,
        "createTime": "2024-07-01 10:00:00"
      }
    ],
    "total": 100,
    "pageNum": 1,
    "pageSize": 20
  }
}
```

---

## 2. 商品详情

### 接口地址
```
GET /api/admin/platform/physical-product/detail/{id}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Integer | 是 | 商品ID |

### 响应示例
```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 94,
    "productType": 1,
    "name": "迪士尼联名T恤",
    "intro": "高品质纯棉材质",
    "image": "https://...",
    "sliderImage": "https://...,https://...",
    "price": 109.00,
    "otPrice": 200.00,
    "stock": 180,
    "sales": 0,
    "unitName": "件",
    "categoryId": 7,
    "brandId": 32,
    "tempId": 1,
    "specType": true,
    "content": "<p>商品详情HTML</p>",
    "isShow": true,
    "auditStatus": 2
  }
}
```

---

## 3. 创建商品

### 接口地址
```
POST /api/admin/platform/physical-product/create
```

### 请求体示例
```json
{
  "type": 0,
  "image": "https://example.com/main.jpg",
  "flatPattern": "https://example.com/flat.jpg",
  "sliderImage": "https://...,https://...,https://...",
  "name": "迪士尼联名T恤",
  "intro": "高品质纯棉材质，迪士尼正版授权",
  "keyword": "迪士尼,T恤,联名",
  "cateId": "1,2",
  "brandId": 32,
  "categoryId": 7,
  "guaranteeIds": "1,2,3",
  "unitName": "件",
  "tempId": 1,
  "sort": 100,
  "specType": true,
  "isSub": false,
  "isPaidMember": false,
  "isAutoUp": false,
  "deliveryMethod": "1",
  "refundSwitch": true,
  "systemFormId": 0,
  "isHot": 0,
  "redeemIntegral": 0,
  "attrList": [
    {
      "attributeName": "颜色",
      "isShowImage": true,
      "optionList": [
        {
          "optionName": "米白色",
          "image": "https://..."
        },
        {
          "optionName": "黑色",
          "image": "https://..."
        }
      ]
    },
    {
      "attributeName": "尺码",
      "isShowImage": false,
      "optionList": [
        {"optionName": "S"},
        {"optionName": "M"},
        {"optionName": "L"}
      ]
    }
  ],
  "attrValueList": [
    {
      "stock": 30,
      "price": 109.00,
      "image": "https://...",
      "cost": 50.00,
      "otPrice": 200.00,
      "weight": 0.3,
      "volume": 0.01,
      "brokerage": 5,
      "brokerageTwo": 2,
      "attrValue": "{\"颜色\":\"米白色\",\"尺码\":\"S\"}",
      "barCode": "",
      "isDefault": true
    },
    {
      "stock": 30,
      "price": 109.00,
      "image": "https://...",
      "cost": 50.00,
      "otPrice": 200.00,
      "weight": 0.3,
      "volume": 0.01,
      "brokerage": 5,
      "brokerageTwo": 2,
      "attrValue": "{\"颜色\":\"米白色\",\"尺码\":\"M\"}",
      "barCode": ""
    }
  ],
  "content": "<p>商品详情HTML内容</p>",
  "couponIds": [1, 2, 3]
}
```

### 响应示例
```json
{
  "code": 200,
  "message": "商品创建成功",
  "data": null
}
```

---

## 4. 更新商品

### 接口地址
```
POST /api/admin/platform/physical-product/update
```

### 请求体示例
```json
{
  "id": 94,
  "name": "迪士尼联名T恤（新款）",
  "intro": "更新的商品简介",
  "price": 119.00,
  "stock": 200,
  "attrList": [...],
  "attrValueList": [...],
  "content": "<p>更新后的详情</p>"
}
```

### 说明
- 只需要传递需要更新的字段
- 如果更新规格，需要传递完整的 `attrList` 和 `attrValueList`
- 系统会自动删除旧规格，保存新规格

### 响应示例
```json
{
  "code": 200,
  "message": "商品更新成功",
  "data": null
}
```

---

## 5. 删除商品（软删除）

### 接口地址
```
POST /api/admin/platform/physical-product/delete/{id}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Integer | 是 | 商品ID |

### 响应示例
```json
{
  "code": 200,
  "message": "商品删除成功",
  "data": null
}
```

---

## 6. 批量删除商品

### 接口地址
```
POST /api/admin/platform/physical-product/batch/delete
```

### 请求体示例
```json
[94, 95, 96]
```

### 响应示例
```json
{
  "code": 200,
  "message": "批量删除成功",
  "data": null
}
```

---

## 7. 上架商品

### 接口地址
```
POST /api/admin/platform/physical-product/on-shelf/{id}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Integer | 是 | 商品ID |

### 响应示例
```json
{
  "code": 200,
  "message": "商品上架成功",
  "data": null
}
```

---

## 8. 下架商品

### 接口地址
```
POST /api/admin/platform/physical-product/off-shelf/{id}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Integer | 是 | 商品ID |

### 响应示例
```json
{
  "code": 200,
  "message": "商品下架成功",
  "data": null
}
```

---

## 9. 获取商品规格列表

### 接口地址
```
GET /api/admin/platform/physical-product/attr/{productId}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| productId | Integer | 是 | 商品ID |

### 响应示例
```json
{
  "code": 200,
  "message": "成功",
  "data": [
    {
      "id": 1,
      "productId": 94,
      "attributeName": "颜色",
      "isShowImage": true,
      "sort": 0
    },
    {
      "id": 2,
      "productId": 94,
      "attributeName": "尺码",
      "isShowImage": false,
      "sort": 1
    }
  ]
}
```

---

## 10. 获取商品SKU列表

### 接口地址
```
GET /api/admin/platform/physical-product/sku/{productId}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| productId | Integer | 是 | 商品ID |

### 响应示例
```json
{
  "code": 200,
  "message": "成功",
  "data": [
    {
      "id": 2430,
      "productId": 94,
      "sku": "{\"颜色\":\"米白色\",\"尺码\":\"S\"}",
      "stock": 30,
      "sales": 0,
      "price": 109.00,
      "image": "https://...",
      "cost": 50.00,
      "otPrice": 200.00,
      "weight": 0.3,
      "volume": 0.01,
      "brokerage": 5.00,
      "brokerageTwo": 2.00
    }
  ]
}
```

---

## 11. 商品统计

### 接口地址
```
GET /api/admin/platform/physical-product/stats
```

### 响应示例
```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "total": 100,
    "onShelf": 75,
    "offShelf": 25,
    "pending": 5
  }
}
```

---

## 数据库结构

### 主要表结构

#### eb_product (商品主表)
```sql
-- 关键字段
product_type INT(2) DEFAULT 1 COMMENT '产品类型：0-课程，1-实物商品'
type INT(2) DEFAULT 0 COMMENT '基础类型：0=普通商品,1-积分商品,2-虚拟商品,4=视频号,5-云盘商品,6-卡密商品'
is_show TINYINT(1) DEFAULT 0 COMMENT '状态（0：未上架，1：上架）'
audit_status INT(2) DEFAULT 1 COMMENT '审核状态：0-无需审核 1-待审核，2-审核成功，3-审核拒绝'
is_del TINYINT(1) DEFAULT 0 COMMENT '是否删除'
```

#### eb_product_attribute (商品规格表)
```sql
product_id INT(11) COMMENT '商品ID'
attribute_name VARCHAR(32) COMMENT '规格名'
is_show_image TINYINT(1) COMMENT '是否展示规格图片'
sort INT(11) COMMENT '排序'
```

#### eb_product_attribute_option (商品规格选项表)
```sql
product_id INT(11) COMMENT '商品ID'
attribute_id INT(11) COMMENT '商品规格ID'
option_name VARCHAR(32) COMMENT '属性名'
image VARCHAR(1000) COMMENT '图片'
```

#### eb_product_attr_value (商品SKU表)
```sql
product_id INT(10) COMMENT '商品ID'
sku VARCHAR(128) COMMENT '商品属性sku'
stock INT(10) COMMENT '库存'
sales INT(10) COMMENT '销量'
price DECIMAL(8,2) COMMENT '价格'
cost DECIMAL(8,2) COMMENT '成本价'
ot_price DECIMAL(8,2) COMMENT '原价'
```

#### eb_product_description (商品详情表)
```sql
product_id INT(11) COMMENT '商品ID'
description TEXT COMMENT '商品详情'
type INT(2) COMMENT '基础类型'
```

---

## 使用说明

### 1. 商品与课程的区分
- **课程**：`product_type = 0`，通过 `/api/admin/platform/product/course/*` 接口管理
- **实体商品**：`product_type = 1`，通过 `/api/admin/platform/physical-product/*` 接口管理

### 2. 创建商品流程
1. 准备商品基本信息（名称、图片、价格等）
2. 配置商品规格（颜色、尺码等）
3. 配置SKU信息（各规格组合的库存、价格）
4. 提交创建请求
5. 商品默认为"待审核"状态

### 3. 规格管理说明
- **单规格商品**：`specType = false`，只有一个默认SKU
- **多规格商品**：`specType = true`，有多个规格和SKU
- SKU的 `sku` 字段存储JSON格式的规格组合，如：`{"颜色":"米白色","尺码":"S"}`

### 4. 库存和价格计算
- 商品的总库存 = 所有SKU的库存之和
- 商品的显示价格 = 所有SKU中的最低价格

### 5. 审核流程
- 新创建的商品默认 `audit_status = 1`（待审核）
- 审核通过后 `audit_status = 2`（审核成功）
- 只有审核通过的商品才能上架

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 404 | 商品不存在 |
| 500 | 服务器内部错误 |

---

## 注意事项

1. **数据完整性**：创建/更新商品时，必须提供完整的规格和SKU数据
2. **事务性**：所有写操作都在事务中执行，保证数据一致性
3. **软删除**：删除商品只是标记 `is_del = 1`，不会真正删除数据
4. **权限控制**：建议配合权限系统使用，控制不同用户的操作权限
5. **图片路径**：确保图片路径正确且可访问
6. **价格精度**：价格使用 `DECIMAL(8,2)`，最多支持2位小数

---

## 测试建议

### 1. 单元测试
- 测试商品CRUD操作
- 测试规格和SKU管理
- 测试库存和价格计算

### 2. 集成测试
- 测试完整的商品创建流程
- 测试商品上下架流程
- 测试批量操作

### 3. 性能测试
- 大量商品列表查询性能
- 复杂规格商品的创建性能

---

# 商品分类管理接口

## 概述
商品分类管理支持**三级分类**结构，用于组织和管理实体商品。分类通过`pid`字段建立父子关系，支持树形展示。

**注意**：商品分类分为**平台分类**和**商户分类**两套独立体系。

---

## 22. 商品分类列表（树形）

### 接口地址

**平台端**：
```
GET /api/admin/platform/product/category/list
```

**商户端**：
```
GET /api/admin/merchant/store/product/category/list
```

### 说明
获取商品分类树形列表，包含所有层级的分类数据。

### 响应示例
```json
{
  "code": 200,
  "message": "成功",
  "data": [
    {
      "id": 1,
      "pid": 0,
      "name": "服装鞋包",
      "icon": "https://...",
      "level": 1,
      "sort": 100,
      "isShow": true,
      "createTime": "2024-01-01 10:00:00",
      "updateTime": "2024-01-15 14:30:00",
      "children": [
        {
          "id": 10,
          "pid": 1,
          "name": "男装",
          "icon": "https://...",
          "level": 2,
          "sort": 50,
          "isShow": true,
          "createTime": "2024-01-02 10:00:00",
          "updateTime": "2024-01-15 14:30:00",
          "children": [
            {
              "id": 100,
              "pid": 10,
              "name": "T恤",
              "icon": "",
              "level": 3,
              "sort": 30,
              "isShow": true,
              "createTime": "2024-01-03 10:00:00",
              "updateTime": "2024-01-15 14:30:00",
              "children": []
            }
          ]
        }
      ]
    }
  ]
}
```

---

## 23. 创建商品分类

### 接口地址

**平台端**：
```
POST /api/admin/platform/product/category/add
```

**商户端**：
```
POST /api/admin/merchant/store/product/category/add
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| pid | Integer | 是 | 父分类ID，创建一级分类时传0 | 0 |
| name | String | 是 | 分类名称，最多100字符 | "T恤" |
| icon | String | 否 | 分类图标URL | "https://..." |
| level | Integer | 是 | 分类级别：1-一级，2-二级，3-三级 | 1 |
| sort | Integer | 是 | 排序值，范围0-9999，越大越靠前 | 100 |

### 请求示例

**创建一级分类**：
```json
{
  "pid": 0,
  "name": "服装鞋包",
  "icon": "https://cdn.example.com/category/clothing.png",
  "level": 1,
  "sort": 100
}
```

**创建二级分类（子分类）**：
```json
{
  "pid": 1,
  "name": "男装",
  "icon": "https://cdn.example.com/category/menswear.png",
  "level": 2,
  "sort": 50
}
```

**创建三级分类**：
```json
{
  "pid": 10,
  "name": "T恤",
  "icon": "",
  "level": 3,
  "sort": 30
}
```

### 响应示例
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 业务规则
1. **pid和level必须匹配**：
   - level=1时，pid必须为0
   - level=2时，pid必须为一级分类的id
   - level=3时，pid必须为二级分类的id
2. **同一父分类下名称不能重复**
3. **最多支持三级分类**

---

## 24. 更新商品分类

### 接口地址

**平台端**：
```
POST /api/admin/platform/product/category/update
```

**商户端**：
```
POST /api/admin/merchant/store/product/category/update
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| id | Integer | 是 | 分类ID | 10 |
| pid | Integer | 是 | 父分类ID | 1 |
| name | String | 是 | 分类名称 | "男装精选" |
| icon | String | 否 | 分类图标URL | "https://..." |
| level | Integer | 是 | 分类级别 | 2 |
| sort | Integer | 是 | 排序值 | 60 |

### 请求示例
```json
{
  "id": 10,
  "pid": 1,
  "name": "男装精选",
  "icon": "https://cdn.example.com/category/menswear-new.png",
  "level": 2,
  "sort": 60
}
```

### 响应示例
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 业务规则
1. **不能修改分类的层级关系导致循环引用**
2. **如果分类下有子分类，不允许修改pid**
3. **level和pid必须保持一致**

---

## 25. 删除商品分类

### 接口地址

**平台端**：
```
POST /api/admin/platform/product/category/delete/{id}
```

**商户端**：
```
POST /api/admin/merchant/store/product/category/delete/{id}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Integer | 是 | 分类ID |

### 响应示例

**成功**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

**失败（有子分类）**：
```json
{
  "code": 400,
  "message": "该分类下存在子分类，无法删除",
  "data": null
}
```

**失败（有关联商品）**：
```json
{
  "code": 400,
  "message": "该分类下存在商品，无法删除",
  "data": null
}
```

### 业务规则
1. **如果分类下有子分类，不允许删除**
2. **如果分类下有关联商品，不允许删除**
3. **必须先删除子分类和商品，才能删除父分类**

---

## 26. 显示/隐藏分类

### 接口地址

**平台端**：
```
POST /api/admin/platform/product/category/update/show/{id}
```

**商户端**：
```
POST /api/admin/merchant/store/product/category/update/show/{id}
```

### 路径参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Integer | 是 | 分类ID |

### 说明
切换分类的显示/隐藏状态。每次调用会切换当前状态（显示→隐藏，隐藏→显示）。

### 响应示例
```json
{
  "code": 200,
  "message": "修改成功",
  "data": null
}
```

### 业务规则
1. **隐藏的分类不会在前端展示**
2. **隐藏分类不影响已关联的商品**
3. **子分类的显示状态独立于父分类**

---

## 27. 分类缓存树

### 接口地址

**平台端**：
```
GET /api/admin/platform/product/category/cache/tree
```

**商户端**：
```
GET /api/admin/merchant/store/product/category/cache/tree
```

### 说明
获取商品分类缓存树，用于下拉选择器等场景，返回格式更适合前端组件使用。

### 响应示例
```json
{
  "code": 200,
  "message": "成功",
  "data": [
    {
      "value": 1,
      "label": "服装鞋包",
      "disabled": false,
      "children": [
        {
          "value": 10,
          "label": "男装",
          "disabled": false,
          "children": [
            {
              "value": 100,
              "label": "T恤",
              "disabled": false,
              "children": []
            }
          ]
        }
      ]
    }
  ]
}
```

### 使用场景
1. **商品编辑页**：选择商品分类
2. **分类筛选器**：下拉选择分类
3. **树形选择组件**：级联选择器

---

## 分类管理最佳实践

### 1. 分类层级设计
```
一级分类（大类）
  ├─ 二级分类（中类）
  │   ├─ 三级分类（小类）
  │   └─ 三级分类（小类）
  └─ 二级分类（中类）
      ├─ 三级分类（小类）
      └─ 三级分类（小类）
```

**示例**：
```
服装鞋包（一级）
  ├─ 男装（二级）
  │   ├─ T恤（三级）
  │   ├─ 衬衫（三级）
  │   └─ 裤子（三级）
  └─ 女装（二级）
      ├─ 连衣裙（三级）
      └─ 短裙（三级）
```

### 2. 分类与商品关联

**平台分类**：
- 商品的`categoryId`字段存储**平台分类ID**（单个，三级分类）
- 用于平台级别的商品管理和筛选

**商户分类**：
- 商品的`cateId`字段存储**商户分类ID**（多个，逗号分隔）
- 用于商户自己的商品组织

**示例**：
```json
{
  "categoryId": 100,           // 平台分类：服装鞋包 > 男装 > T恤
  "cateId": "1,5,8"           // 商户分类：新品,热销,促销
}
```

### 3. 分类操作顺序

**创建分类**：
1. 先创建一级分类
2. 再创建二级分类（指定一级分类的id作为pid）
3. 最后创建三级分类（指定二级分类的id作为pid）

**删除分类**：
1. 先删除或转移该分类下的所有商品
2. 再删除三级分类
3. 然后删除二级分类
4. 最后删除一级分类

### 4. 注意事项

1. **商品必须关联三级分类**：创建商品时必须选择最底层的分类
2. **分类ID不可重复使用**：删除后的分类ID不会被重用
3. **缓存更新**：修改分类后，缓存树会自动更新
4. **排序规则**：sort值越大越靠前，建议预留间隔（如100、200、300）方便插入

---

## 后续优化建议

1. **缓存优化**：对商品列表和详情添加Redis缓存
2. **搜索优化**：集成Elasticsearch实现高级搜索
3. **图片处理**：添加图片压缩和CDN加速
4. **批量导入**：支持Excel批量导入商品
5. **数据分析**：添加商品销售数据分析功能
6. **库存预警**：库存不足时自动预警
7. **分类图标库**：提供常用分类图标库供选择
